# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Development Commands

**Essential Commands:**

- `pnpm dev` - Start development server (with Turbopack)
- `pnpm build` - Production build
- `pnpm lint` - Run ESLint (treat warnings as errors with `--max-warnings=0`)
- `pnpm format` - Format with Prettier
- `pnpm test` - Run unit tests with Vitest
- `pnpm test:ui` - Run tests with Vitest UI
- `pnpm e2e` - Run Playwright E2E tests

**Database Commands:**

- `pnpm db:generate` - Generate Drizzle migrations
- `pnpm db:push` - Push schema changes to database
- `pnpm db:studio` - Open Drizzle Studio

**Code Quality:**

- All code must pass ESLint with zero warnings (`--max-warnings=0`)
- All code must be formatted with Prettier
- Pre-commit hooks run lint-staged automatically
- Use `pnpm format:check` to verify formatting

## Architecture Overview

**Next.js 15 App Router Structure:**

- Uses React 19 with App Router
- TypeScript with strict mode enabled
- Path alias: `@/*` maps to `./src/*`

**Database & State:**

- Supabase PostgreSQL with Drizzle ORM
- Schema defined in `src/db/schema.ts`
- TanStack Query for data fetching
- Zustand for client state management

**Key Domain Models:**

- **Mesocycles**: Training programs with periodization (intensity progressions)
- **Workouts**: Individual training sessions within mesocycles
- **Exercises**: Comprehensive exercise database with muscle groups
- **Sets**: Logged performance data (weight, reps, RIR, RPE)

**Progression System:**
The app implements sophisticated periodization through `IntensityParameters` and `WeekIntensity` types that modulate volume, weight, RIR, RPE across mesocycle weeks. The progression system supports linear, wave, and custom strategies.

**UI Components:**

- Built on Radix UI primitives with shadcn/ui
- Tailwind CSS v4 for styling
- Theme support via next-themes
- Mobile-first responsive design

**Testing:**

- Unit tests: Vitest with React Testing Library
- E2E tests: Playwright
- Test files in `src/**/__tests__/` and `e2e/`
- Setup file: `src/test/setup.ts`

## Environment Variables

Required for development:

```
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
DATABASE_URL=your_database_connection_string
```

## Important Patterns

**Data Fetching:**

- Use TanStack Query for server state
- Database queries organized in `src/db/queries/`
- Supabase clients in `src/lib/supabase/`

**Component Organization:**

- Page components in `src/app/` (App Router)
- Reusable components in `src/components/` by feature
- UI primitives in `src/components/ui/`

**Type Safety:**

- Database schema types generated by Drizzle
- Custom types in `src/types/` and `src/lib/types/`
- Progression system has complex nested types for periodization
